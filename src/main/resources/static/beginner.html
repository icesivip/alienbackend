<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">


  <title>LINEAR - OPTIMIZATION</title>

  <!-- Custom fonts for this template-->
  <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
  <link
    href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
    rel="stylesheet">

  <!-- Custom styles for this template-->
  <link href="css/sb-admin-2.min.css" rel="stylesheet">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
  <!--    <script src="vendor/chart.js/Chart.min.js"></script> -->

  <script src="vendor/datatables/jquery.dataTables.min.js"></script>
  <link href="vendor/datatables/dataTables.bootstrap4.min.css" rel="stylesheet">
  <script src="vendor/datatables/dataTables.bootstrap4.min.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@0.7.0"></script>
</head>

<body id="page-top">

  <!-- Page Wrapper -->
  <div id="wrapper">

    <!-- Sidebar -->
    <ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion" id="accordionSidebar">

      <!-- Sidebar - Brand -->
      <a class="sidebar-brand d-flex align-items-center justify-content-center" href="index.html">
        <div class="sidebar-brand-icon rotate-n-15">
          <i class="fas fa-laugh-wink"></i>
        </div>
        <div class="sidebar-brand-text mx-3">VIP ALIEN <sup></sup></div>
      </a>

      <!-- Divider -->
      <hr class="sidebar-divider my-0">

      <!-- inútil por ahora -->
      <!-- Nav Item - Dashboard -->
      <!--li class="nav-item active">
        <a class="nav-link" href="index.html">
          <i class="fas fa-fw fa-tachometer-alt"></i>
          <span>Dashboard</span></a>
      </li-->

      <!-- Divider -->
      <hr class="sidebar-divider">

      <!-- Heading -->
      <div class="sidebar-heading">
        Modules
      </div>
      <!-- PL -->
      <li class="nav-item">
        <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapsePages" aria-expanded="true"
          aria-controls="collapsePages">
          <i class="fas fa-fw fa-folder"></i>
          <span> Linear Programming </span>
        </a>
        <div id="collapsePages" class="collapse" aria-labelledby="headingPages" data-parent="#accordionSidebar">
          <div class="bg-white py-2 collapse-inner rounded">
            <h6 class="collapse-header">Programs</h6>
            <a class="collapse-item" href="interiorPoint.html">Interior Point</a>
            <a class="collapse-item" href="graphicalMethod.html">Graphical Method</a>
            <a class="collapse-item" href="branchAndBound.html">Branch & Bound</a>
            <a class="collapse-item" href="homeSimplex.html">Simplex Algorithm </a>
            <a class="collapse-item" href="neos_server_integration_ampl.html">NEOS Server</a>
          </div>
        </div>
      </li>
      <!-- Es necesario entender cómo funcion el #collapse, parece un id, pero no lo encuentro en css-->
      <!-- MPS -->
      <li class="nav-item">
        <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseMPS" aria-expanded="true"
          aria-controls="collapseMPS">
          <i class="fas fa-fw fa-folder"></i>
          <span> Master Plan Schedule </span>
        </a>
        <div id="collapseMPS" class="collapse" aria-labelledby="headingMPS" data-parent="#accordionSidebar">
          <div class="bg-white py-2 collapse-inner rounded">
            <h6 class="collapse-header">Programs</h6>
            <!-- cambiar href -->
            <a class="collapse-item" href="mps.html">MPS</a>
            <a class="collapse-item" href="mrp-1.html">MRP</a>
          </div>
        </div>
      </li>
      <li class="nav-item">
        <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseNet" aria-expanded="true"
          aria-controls="collapseNet">
          <i class="fas fa-project-diagram"></i>
          <span> Networks </span>
        </a>
        <div id="collapseNet" class="collapse" aria-labelledby="headingNet" data-parent="#accordionSidebar">
          <div class="bg-white py-2 collapse-inner rounded">
            <h6 class="collapse-header">Programs</h6>
            <!-- cambiar href -->
            <a class="collapse-item" href="shortestPath.html">SHORTEST PATH</a>
            <a class="collapse-item" href="mst.html">MST</a>
            <a class="collapse-item" href="mfp.html">MFP</a>
          </div>
        </div>
      </li>

      <!-- Nav Item - Pages Collapse Menu -->
      <li class="nav-item">
        <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="true" aria-controls="collapseTwo">
          <i class="fas fa-fw fa-cog"></i>
          <span>CPM vs PERT</span>
        </a>
        <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordionSidebar">
          <div class="bg-white py-2 collapse-inner rounded">
            <h6 class="collapse-header">components</h6>
            <a class="collapse-item" href="cpm.html">CPM</a>
            <a class="collapse-item" href="pert.html">PERT</a>
          </div>
        </div>
      </li>

      <!-- Divider -->
      <hr class="sidebar-divider">

      <!-- Divider -->
      <hr class="sidebar-divider d-none d-md-block">

      <!-- Sidebar Toggler (Sidebar) -->
      <div class="text-center d-none d-md-inline">
        <button class="rounded-circle border-0" id="sidebarToggle"></button>
      </div>

    </ul>
    <!-- End of Sidebar -->

    <!-- Content Wrapper -->
    <div id="content-wrapper" class="d-flex flex-column">

      <!-- Main Content -->
      <div id="content">

        <!-- Topbar -->
        <nav class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow">

          <!-- Sidebar Toggle (Topbar) -->
          <button id="sidebarToggleTop" class="btn btn-outline-link d-md-none rounded-circle mr-3">
            <i class="fa fa-bars"></i>
          </button>

          <!-- Topbar Search -->
          <form class="d-none d-sm-inline-block form-inline mr-auto ml-md-3 my-2 my-md-0 mw-100 navbar-search">
            <div class="input-group">
              <button class="btn btn-outline-primary nav-button" type="button" data-toggle="modal"
                data-target="#uploadModal">
                Upload Problem
                <i class="fas fa-upload"></i>
              </button>
              <button onclick="saveProblem()" class="btn btn-outline-primary nav-button" type="button">
                Save Problem
                <i class="far fa-save"></i>
              </button>
            </div>
          </form>
          <div class="modal fade" id="uploadModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
            aria-hidden="true">
            <div class="modal-dialog" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="exampleModalLabel">Uploading Saved Problem</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <form id="upload-form">
                  <div class="modal-body">
                    <p>
                      Here you have to select a previously saved problem in .json format. Make
                      sure the file has not
                      been modified or there are going to be problems in the upload process.
                    </p>

                    <div class="form-group">
                      <label for="exampleFormControlFile1">Choose File</label>
                      <input type="file" class="form-control-file" id="fileUpload" accept=".json" required>
                    </div>

                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="input" class="btn btn-primary">Upload</button>
                  </div>
                </form>
              </div>
            </div>
          </div>
          <!-- Topbar Navbar -->
          <ul class="navbar-nav ml-auto">

            <!-- Nav Item - Search Dropdown (Visible Only XS) -->
            <li class="nav-item dropdown no-arrow d-sm-none">
              <a class="nav-link dropdown-toggle" href="#" id="searchDropdown" role="button" data-toggle="dropdown"
                aria-haspopup="true" aria-expanded="false">
                <i class="fas fa-search fa-fw"></i>
              </a>
              <!-- Dropdown - Messages -->
              <div class="dropdown-menu dropdown-menu-right p-3 shadow animated--grow-in"
                aria-labelledby="searchDropdown">
                <form class="form-inline mr-auto w-100 navbar-search">
                  <div class="input-group">
                    <input type="text" class="form-control bg-light border-0 small" placeholder="Search for..."
                      aria-label="Search" aria-describedby="basic-addon2">
                    <div class="input-group-append">
                      <button class="btn btn-outline-primary" type="button">
                        <i class="fas fa-search fa-sm"></i>
                      </button>
                    </div>
                  </div>
                </form>
              </div>
            </li>

            <!-- Nav Item - Alerts -->
            <li class="nav-item dropdown no-arrow mx-1">

              </a>
              <!-- Dropdown - Alerts -->


              <!-- Nav Item - Messages -->




              <!-- Nav Item - User Information -->


          </ul>

        </nav>
        <!-- End of Topbar -->
        <style>
          .input-group {
            position: relative;
            display: -webkit-box;
            display: -ms-flexbox;

            -ms-flex-wrap: wrap;
            flex-wrap: wrap;
            -webkit-box-align: stretch;
            -ms-flex-align: stretch;
            align-items: stretch;
            width: 100%;
          }
          input[type=number] {
            width: 100%;
        }
          .container1 {
            position: relative;
            text-align: center;
            color: black;


            font-family: 'Times New Roman', Times, serif;

          }

          .container1-1 {
            position: absolute;
            text-anchor: middle;
            top: -20%;
            left: 50%;
            transform: translate(-50%, 20%);


          }

          form.user .form-control-user{
            font-size: larger;
            border-radius: .35rem;
            padding: 1.5rem 1rem;
             width: 100%;
          }
         
          #cTitle{
            font-size: larger;
            border-radius: 10rem;
            padding: 1.5rem 1rem;
          }
          #cVariable{
            font-size: larger;
            border-radius: 10rem;
            padding: 1.5rem 1rem;
          }
          #goConstraint{
            font-size: larger;
            border-radius: 10rem;
            padding: 1.5rem 1rem;
          }
          .btn-icon-split {

            position: relative;


          }


          #but2 {

            width: 100%;
          }

          .table {
            color: black;
            text-align: center;

          }

          .cover {
            opacity: 0.8;
            background-color: #ccc;
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0px;
            left: 0px;
            z-index: 1000;
            background: url(img/loading.gif) center center no-repeat;
            display: none;
          }

          .h3,
          h3 {
            font-size: 1.75rem;
            color: black;
          }

          #menIteration {
            color: black;

            font-size: larger;
          }
        </style>
        <!-- Begin Page Content -->
        <div class="container-fluid">
          <div class="cover"></div>
          <!-- Page Heading -->
          <div class="text-center">
            <h1>Simplex Method </h1>
            <h2>Solver </h2>
          </div>

        </div>
        <!-- /.container-fluid -->
        <div class="col-lg">
          <!-- Nested Row within Card Body -->
          <div class="p-5">
            <form class="user" id="user">
              <div class="col-sm-6">
                <a href="homeSimplex.html" class="btn btn-outline-secondary btn-icon-split">
                  <span class="icon text-white-50">
                    <i class="fas fa-arrow-left"></i>
                  </span>
                  <span class="text">Back</span>
                </a>
              </div>

              <hr>
              <h2 class='text-center'>Problem Title</h2>
              <div class="form-group2">
                <div class="col-sm-14 ">
                  <input type="text" class="form-control form-control-user" id="cTitle" required="">
                </div>
              </div>
          
              <hr>
              <div class="row">
                <div class="col-sm-2"></div>
               
                
                <div class="col-sm-4 mb-3 mb-sm-0">  
                  <h2 >Number of Variables</h2>

                  <div class="form-group row ">
                      <div class="col-sm-10 mb-3 mb-sm-0">
                          <input type="number" class="form-control form-control-user" id="cVariable" >
                      </div>
                     
                        </div></div>
                <div class="col-sm-4 mb-3 mb-sm-0">
                    <h2>Number of Constraints</h2>

                    <div class="form-group row">
                        <div class="col-sm-10 mb-3 mb-sm-0">
                            <input type="number" class="form-control form-control-user" id="goConstraint" >
                        </div>
                      
                    </div>

                </div>
                <div class="col-sm-1"></div>
                  
                
               
              </div>
              <div class="row">
                  <div class="col-sm-5 mb-0 mb-sm-0"></div>
                 
                  <div class="col-sm-2">
                      <button onclick="createTable()" class="btn btn-outline-success btn-icon-split" type="button" >
                          <span class="icon text-white-50">
                            <i class="fas fa-check"></i>
                          </span>
                          <span class="text" href="#thead-tr">Go!</span>
                        </button>
                  </div>
                  <div class="col-sm-4"></div>
                  <div class="col-sm-2"></div>
              </div>


                <hr>



              <div class="table-responsive">
                <h2 class="text-center">Objective Function</h2>
                <table class="table table-bordered" id="result" width="100%" cellspacing="0">
                  <thead class="white-text bg-primary">
                    <tr class="text-center" id="of-head">
                      <th>
                        <font color="#fff">Type</font>
                      </th>
                      <th>
                        <font color="#fff">X1</font>
                      </th>
                      <th>
                        <font color="#fff">X2</font>
                      </th>
                      <th>
                        <font color="#fff">X3</font>
                      </th>


                    </tr>
                  </thead>
                  <tbody id="of-body">
                    <tr>
                      <td>
                        <select>
                          <option>MAXIMIZE</option>
                          <option>MINIMIZE</option>

                        </select>
                      </td>
                      <td><input type="number" step="0.01" required class="form-control form-control-user"></td>
                      <td><input type="number" step="0.01" required class="form-control form-control-user"></td>
                      <td><input type="number" step="0.01" required class="form-control form-control-user"></td>


                    </tr>


                  </tbody>




                </table>

              </div>




              <hr>

              <div class="table-responsive">
                <h2 class="text-center">Constraint Table</h2>
                <table class="table table-bordered" width="100%" cellspacing="0">
                  <thead class="white-text bg-primary">
                    <tr class="text-center" id="thead-tr">
                      <th>
                        <font color="#fff">X1</font>
                      </th>
                      <th>
                        <font color="#fff">X2</font>
                      </th>
                      <th>
                        <font color="#fff">X3</font>
                      </th>
                      <th>
                        <font color="#fff">Type</font>
                      </th>
                      <th>
                        <font color="#fff">Value</font>
                      </th>
                    </tr>
                  </thead>
                  <tbody id="table-body">
                    <tr>
                      <td><input type="number" step="0.01" required class="form-control form-control-user"></td>
                      <td><input type="number" step="0.01" required class="form-control form-control-user"></td>
                      <td><input type="number" step="0.01"  required class="form-control form-control-user" ></td>
                      <td> <select>
                          <option>&lt=</option>
                          <option>&gt=</option>
                          <option>=</option>
                        </select>
                      </td>
                      <td><input type="number" step="0.01"  required class="form-control form-control-user"></td>
                    </tr>


                  </tbody>




                </table>


              </div>

              <hr>
              <div class="text-black">
                <div class="form-group form-row">

                  <div class="col-sm-6 mb-3 ">
                    <button onclick="addVar()" class="btn btn-outline-success btn-user btn-block" type='button'>
                      Add Variable

                    </button>
                  </div>
                  <div class="col-sm-6 mb-3">
                    <button onclick="removeVar()" class="btn btn-outline-danger btn-user btn-block" type='button'>
                      Remove Variable
                    </button>
                  </div>

                  <div class="col-sm-6 mb-3 ">
                    <button onclick="addCons()" class="btn btn-outline-success btn-user btn-block" type='button'>
                      Add Constraint

                    </button>
                  </div>
                  <div class="col-sm-6 mb-3">
                    <button onclick="removeCons()" class="btn btn-outline-danger btn-user btn-block" type='button'>
                      Remove Constraint
                    </button>
                  </div>

                </div>
                <hr>
                <br>
                <div class="text-black">
                  <div class="row">

                    <div class="col">
                      <button onclick=" finalSolution()" id="but2" class="btn btn-outline-secondary btn-icon-split"
                        type="button">

                        <span class="text" id="finalS">Final Solution</span>
                      </button>

                    </div>

                    <div class="col">
                      <button onclick="nextSolution()" id="but2" class="btn btn-outline-secondary btn-icon-split"
                        type="button">

                        <span class="text" id="StepB">Step by Step</span>
                      </button>
                    </div>
                  </div>
                </div>
                <hr>




              </div>
              <br>




              <div style="display: none" id="resultTable-cont" class="table-responsive">
                <h2 class="text-center">Data Table</h2>
                <div id="menIteration"> </div>
                <table class="table table-bordered" width="100%" cellspacing="0" id="resultTable">
                  <thead class="white-text bg-primary">


                  </thead>
                  <tbody>

                  </tbody>




                </table>

                <br>
                <div class="row">

                  <div class="col">
                    <button onclick=" back()" id="but2" class="btn btn-outline-secondary btn-icon-split"
                      type="button">

                      <span class="text" id="finalS">Last step</span>
                    </button>

                  </div>

                  <div class="col">
                    <button onclick="nextSolution()" id="but2" class="btn btn-outline-secondary btn-icon-split"
                      type="button">

                      <span class="text" id="StepB">Next step</span>
                    </button>
                  </div>
                </div>

                <br>
                <div id="mensajeS">
                </div>

              </div>
              
              <div style="display: none" class="table-responsive" id = "tableReducedCosts">

                <h2 class="text-center">Reduced costs table</h2>
               
                <table class="table table-bordered" id="tReduced" width="100%" cellspacing="0">

                      
                    <thead class="white-text bg-primary">
                        
                        <tr id="thead-RC">
                            <th>
                              <font color='#fff'>Name</font>
                            </th>
                            <th>
                              <font color='#fff'>Final value</font>
                            </th>
                          <th>
                                <font color="#fff">Reduced costs</font>
                            </th>
                            <th>
                                <font color="#fff">Coefficient Objective</font>
                            </th>
                            <th>
                                <font color="#fff">Permissible to reduce</font>
                            </th>
                            <th>
                                <font color="#fff">Permissible to increase</font>
                            </th>
                        </tr>
                        
                    </thead>
                   
                    <tbody id="tbody-RC">
                      
    
                    </tbody>
    
                 
    
    
                </table>
                </div>

                <div style="display: none" class="table-responsive" id = "tableShadowPrices">

                  <h2 class="text-center">Shadow prices table</h2>
                 
                  <table class="table table-bordered" id="tReduced" width="100%" cellspacing="0">
  
                        
                      <thead class="white-text bg-primary">
                          
                          <tr id="thead-SP">
                              <th>
                                <font color='#fff'>Name</font>
                              </th>
                              <th>
                                <font color='#fff'>Final value</font>
                              </th>
                            <th>
                                  <font color="#fff">Shadow prices</font>
                              </th>
                              <th>
                                  <font color="#fff">RHS Constraint</font>
                              </th>
                              <th>
                                  <font color="#fff">Permissible to reduce</font>
                              </th>
                              <th>
                                  <font color="#fff">Permissible to increase</font>
                              </th>
                          </tr>
                          
                      </thead>
                     
                      <tbody id="tbody-SP">
                          
                      </tbody>
      
                   
      
      
                  </table>
                  <hr>
                  </div>


            </form>

          </div>



          <!-- End of Main Content ------>

          <!-- Footer -->
          <footer class="sticky-footer bg-white">
            <div class="container my-auto">
              <div class="copyright text-center my-auto">
                <span>Copyright &copy; Your Website 2019</span>
              </div>
            </div>
          </footer>
          <!-- End of Footer -->

        </div>
        <!-- End of Content Wrapper -->

      </div>
      <!-- End of Page Wrapper -->

      <!-- Scroll to Top Button-->
      <a class="scroll-to-top rounded" href="#page-top">
        <i class="fas fa-angle-up"></i>
      </a>

      <!-- Logout Modal-->
      <div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Ready to Leave?</h5>
              <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">×</span>
              </button>
            </div>
            <div class="modal-body">Select "Logout" below if you are ready to end your current session.</div>
            <div class="modal-footer">
              <button class="btn btn-outline-secondary" type="button" data-dismiss="modal">Cancel</button>
              <a class="btn btn-outline-primary" href="login.html">Logout</a>
            </div>
          </div>
        </div>
      </div>
      <script>

        var varCount = 3;
        var consCount = 1;

        function countVariables(num2) {
          var num = num2 - 3;
          return num / 2;
        }

        document.getElementById("upload-form").addEventListener("submit", function (e) {
          e.preventDefault();
          var file = document.getElementById("fileUpload").files[0];
          urlFile = window.URL.createObjectURL(file);
          $.ajax({
            url: urlFile
          }).then(function (data) {
            
            console.log(data);
            var split = data.data.split('|');
            var title = split[0]
            if (title != "null") {
              document.getElementById("cTitle").value = title;
            }
            var obj = split[1].split('?');
            var obj2 = obj[1].split('&');

            var obj3 = obj2[1].split('=');
            var numVar = obj3[1]
            var numVar2 = numVar.split(' ');
            var c = 2;
           
            
            
            var numberVar = countVariables(numVar2.length)


            if (numberVar > varCount) {
              for (i = 0; i < numberVar; i++) {
                if (varCount < numberVar) {
                  addVar();
                  if (varCount == numberVar) break;
                }
              }
            }
            else if (numberVar < varCount) {
              for (i = 0; i < numberVar; i++) {
                if (varCount > numberVar) {
                  removeVar();
                  if (varCount == numberVar) break;
                }
              }
            }

            $('#of-body td').each(function (index) {
              if (index == 0) {
                if (obj2[0].substring(5, 14) == 'MAXIMIZE') {
                  $(this).find('select').val("MAXIMIZE");
                }
                else {
                  $(this).find('select').val("MINIMIZE");
                }
              } else {


                $(this).find('input').val(-numVar2[c]);
                c += 2;


              }

            });
            var constraints = split[1].split('n').length-3;
            for (let i = 0; i < constraints; i++) {
              addCons();
               
             }
             var restricciones = split[1].split('n');
             var numerosTabla=[];
             var simbolos = [];
             
            for (let index = 0; index < consCount; index++) {
              var restr = restricciones[2+index];
              var restr = restr.split(' ');
              
              for (let j = 0; j < varCount+1 ;j++) {
                if(((2*j)+2)!=restr.length-2 ){
                numerosTabla.push(restr[(2*j)+2]);
                
                }else{
                  numerosTabla.push(restr[restr.length-1]);
                  simbolos.push(restr[(2*j)+2]);
                }
              }
             
              
            }
         
            var numero=0;
            var valor = 0;
            $('#table-body tr').each(function (i) {
              $(this).find('td').each(function (j) {
                   
                   if(j!=varCount){
                   
                    $(this).find('input').val(numerosTabla[numero]);
                    
                   
                   
                   numero++;
                   
                   }else{
                     j++;
                     if (simbolos[valor] == '<=') $(this).find('select').val("<=");
                                  else if (simbolos[valor] == '>=') $(this).find('select').val(">=");
                                  else $(this).find('select').val("=");
                                  valor++;
                   }

                  
                   
              });
                   
            });
            

          }, function (error) {
            alert("Failed to process request.")
            console.log(error);
          });
          $('#uploadModal').modal('hide');
          $('body').removeClass('modal-open');
          $('.modal-backdrop').remove();
          
        });
       
        function addCons() {
          $("#table-body").append(generateNewConsRow(varCount));
          consCount++;
        }

        function removeVar() {
          if (varCount > 1) {

            $("#thead-tr th:nth-child(" + (varCount) + ")").remove();
            $("#table-body tr td:nth-child("+(varCount)+")").remove();

            $("#of-head th:nth-child(" + (varCount + 1) + ")").remove();
            $("#of-body tr td:nth-child(" + (varCount+1) + ")").remove();
            varCount--;
          }

        }

        function generateNewConsRow(count) {
          var st = "<tr>";
          for (let index = 0; index < count; index++) {
            st += "<td><input type='number' step='0.01' required class='form-control form-control-user'></td>";

          }
          st += "<td> <select><option>&lt=</option><option>&gt=</option><option>=</option></select></td><td><input type='number' step='0.01' required class='form-control form-control-user'></td></tr>"
          return st;
        }

        function removeCons() {

          if (consCount > 1) {

            $("#table-body tr").last().remove();
            consCount--;
          }

        }

        function addVar() {
          $("#thead-tr th:nth-child(" + (varCount) + ")").after("<th><font color='#fff'>X" + (varCount + 1) + "</font></th>");
          for (let i = 0; i < consCount; i++) {
              $("#table-body tr:nth-child("+(i+1)+") td:nth-child("+varCount+")").after("<td><input type='number' step='0.01' required class='form-control form-control-user'></td>");
              }
          $("#of-head th:nth-child(" + (varCount + 1) + ")").after("<th><font color='#fff'>X" + (varCount + 1) + "</font></th>");
          $("#of-body tr").append("<td><input type='number' step='0.01' required class='form-control form-control-user'></td>");


          varCount++;

        }

        function insertAtIndex(i) {
          if (i === 0) {
            $("#controller").prepend("<div>okay things</div>");
            return;
          }


          $("#controller > div:nth-child(" + (i) + ")").after("<div>great things</div>");
        }

        //-----------------------------------
        function goConst() {

          var nConst = parseInt(document.getElementById("goConstraint").value) - consCount;

          if (nConst > 0) {
            for (var j = 0; j < nConst; j++) {
              addCons();
            }

          } else if (nConst < 0) {
            var rem = Math.abs(nConst);
            for (var j = 0; j < rem; j++) {
              removeCons();
            }
          }
        }
        function goVar() {
          var nVar = parseInt(document.getElementById("cVariable").value) - varCount;
          if (nVar > 0) {
            for (var j = 0; j < nVar; j++) {
              addVar();

            }

          } else if (nVar < 0) {
            var rem = Math.abs(nVar);
            for (var j = 0; j < rem; j++) {
              removeVar();
            }
          }
        }
        function createTable(){
          
          goVar();
          goConst();
        }
        //-----------------------------------



        function constructRequestString() {


          type = "";

          var menFun = "";
          $('#of-body td').each(function (index) {
            if (index == 0) {
              type = ($(this).find('select').val());

            } else {
              menFun += (-($(this).find('input').val())) + " X" + index + " ";
            }
          });

          obfun = 1 + " Z " + menFun + "= 0";

          var menObj = "";
          $('#table-body tr').each(function (i) {
            menObj += "n0 Z ";
            $(this).find('td').each(function (j) {

              if (j < varCount || j == varCount + 1) {

                if (j == varCount + 1) {
                  menObj += " " + $(this).find('input').val();
                } else {

                  menObj += +$(this).find('input').val() + " X" + (j + 1) + " ";
                }
              } else {
                menObj += $(this).find('select').val();
              }
            });
          });
          console.log("?type=" + type + "&" + "equations=" + obfun + menObj);



          return "?type=" + type + "&" + "equations=" + obfun + menObj;
        }
        var analysis;
        var solutionValues;
        var nVarDeci;
        var rhsInitM;
        var shadowPrices;
        var fobjective;
        var variableNames;
        var constraintValues;
        var messageSol;

        function finalSolution() {
          $(".cover").toggle(400);
          $("#menIteration").empty();
          var rest = varCount + 1
          var string = constructRequestString();
          $.ajax({
            url: "https://icesiviptest.herokuapp.com/simplexMethod" + string
            //url: "http://localhost:8080/simplexMethod" + string
             
          }).then(function (data) {
            $("#resultTable-cont").show();
            $(".cover").toggle(600);
            variableNames = data.everyVariableName;
            var actualMatrix = data.actualMatrix;
            messageSol = data.messageSol;
            var operationsDone = data.operationsDone;
            solutionValues = data.varsValuesSolution;
            var theta = data.theta;
            var varsBase = data.varsBase;
            rhsInitM = data.rhsinitialM;
            nVarDeci = data.nVarDecision;
            analysis = data.analysis;
            shadowPrices = analysis.shadowPrice;
            fobjective = data.fobj;
            constraintValues = data.finalValuesConstraints;
            reducedC = data.reducedCosts;
            $("#resultTable thead").empty();
            $("#resultTable tbody").empty();
            console.log(data)


            var p1 = new Promise((resolve, reject) => {
              $("#resultTable thead").append("<tr></tr>");
              $("#resultTable thead").find("tr").append("<th><font color='#fff'>Basics Variables</font></th>");
              $("#resultTable thead").find("tr").append("<th><font color='#fff'>Z</font></th>");
              for (index = 0; index < variableNames.length; index++) {
                $("#resultTable thead").find("tr").append("<th><font color='#fff'>" + variableNames[index] + "</font></th>");

              }
              $("#resultTable thead").find("tr").append("<th><font color='#fff'>RHS</font></th>");
             

              resolve();
            });

            for (let index = 0; index < actualMatrix.length; index++) {

              if (index == 0) {
                $("#resultTable tbody").append("<tr ></tr>");
                $("#resultTable tbody").find("tr").append("<td>Z</td>");
                $("#resultTable tbody").find("tr").append("<td>1</td>");
                for (let j = 0; j < actualMatrix[0].length; j++) {
                  $("#resultTable tbody").find("tr").append("<td>" + actualMatrix[0][j] + "</td>");
                }
               
              } else if (index > 0) {
                console.log("index:" + index + " valor:" + varsBase[index - 1])
                $("#resultTable tbody").append("<tr id='row" + index + "'></tr>");
                $("#resultTable tbody").find("#row" + index).append("<td>" + varsBase[index - 1] + "</td>");
                $("#resultTable tbody").find("#row" + index).append("<td>0</td>");
                for (let j = 0; j < actualMatrix[0].length; j++) {
                  $("#resultTable tbody").find("#row" + index).append("<td>" + actualMatrix[index][j] + "</td>");
                }
              }
            }
            showSolution();
          }, function (error) {
            $(".cover").toggle(900);
            alert("Failed to process requests.")

            console.log(error);
          });
        }

        function toInfinity(numberI) {
          if (numberI < -999999999999999999)
          return "-&#8734";
          else if (numberI > 999999999999999999)
          return "&#8734";
          else return numberI;
        }

        function analysisS() {
        $("#tableReducedCosts").show();
        $("#tableShadowPrices").show();
      $("#Analysis").remove();
      $("#tbody-RC").empty();
      $("#tbody-SP").empty();
          $("#mensajeS").append("<h3 class = 'text-center'>Sensitivity Analysis:</h3>");
          $("#mensajeS").append("<div class='row'><h4 class='col-sm-6'><font color='black'>Equations for Shadow prices intervals</font></h4><h4 class='col-sm-6'><font color='black'>Equations for reduced costs intervals</font></h4></div>");
          $("#mensajeS").append("<div class='row'><h5 class='col-sm-6'><font color='black'>"+analysis.equationsConstraints+"</font></h5><h5 class='col-sm-6'><font color='black'>"+analysis.equationsFO+"</font></h5></div>");
          //llena las tablas del analisis
          for (let index = 0; index < analysis.intervalsDConstraints.length; index++) {
            $("#tbody-SP").append('<tr><th id="nameSP0">Constraint '+(index+1)+'</th><td id="fValueSP0">'+ constraintValues[index] +'</td><td id="sPrice0">'+ shadowPrices[0][index] +'</td><td id="rhsCons0">'+rhsInitM[index + 1]+'</td><td id="pReduceSP0">'+toInfinity(analysis.intervalsDConstraints[index][0])+'</td><td id="pIncreaseSP0">'+toInfinity(analysis.intervalsDConstraints[index][1])+'</td></tr>')
          }
            for (let index = 0; index < analysis.intervalsDFO.length; index++) {
              $("#tbody-RC").append('<tr><th id="nameRC0">'+variableNames[index]+'</th><td id="fValueRC0">'+ solutionValues[index] +'</td><td id="rCost0">'+ toInfinity(reducedC[index])+'</td><td id="cObj0">'+fobjective[index]+'</td><td id="pReduceRC0">'+toInfinity(analysis.intervalsDFO[index][0])+'</td><td id="pIncreaseRC0">'+toInfinity(analysis.intervalsDFO[index][1])+'</td></tr>')
          }
     }



        function constructRequestString2(numero) {

          var iteration = numero;
          type = "";

          var menFun = "";
          $('#of-body td').each(function (index) {
            if (index == 0) {
              type = ($(this).find('select').val());

            } else {
              menFun += (-($(this).find('input').val())) + " X" + index + " ";
            }
          });

          obfun = 1 + " Z " + menFun + "= 0";

          var menObj = "";
          $('#table-body tr').each(function (i) {
            menObj += "n0 Z ";
            $(this).find('td').each(function (j) {

              if (j < varCount || j == varCount + 1) {

                if (j == varCount + 1) {
                  menObj += " " + $(this).find('input').val();
                } else {

                  menObj += +$(this).find('input').val() + " X" + (j + 1) + " ";
                }
              } else {
                menObj += $(this).find('select').val();
              }
            });
          });

          console.log("?type=" + type + "&" + "iteration=" + iteration + "&" + "equations=" + obfun + menObj);



          return "?type=" + type + "&" + "iteration=" + iteration + "&" + "equations=" + obfun + menObj;
        }
        
        veces = -1;
        termino = false;

        function back() {
          if(veces>0)
          veces--;
          console.log(veces)
          var rest = varCount + 1
          var string = constructRequestString2(veces);

          $.ajax({
            url: "https://icesiviptest.herokuapp.com/simplexMethod" + string
            //url: "http://localhost:8080/simplexMethod" + string
          }).then(function (data) {
            $("#resultTable-cont").show();
            variableNames = data.everyVariableName;
            var actualMatrix = data.actualMatrix;
            messageSol = data.messageSol;
            var operationsDone = data.operationsDone;
            var theta = data.theta;
            var varsBase = data.varsBase;
            solutionValues = data.varsValuesSolution;
            rhsInitM = data.rhsinitialM;
            nVarDeci = data.nVarDecision;
            analysis = data.analysis;
            fobjective = data.fobj;
            reducedC = data.reducedCosts;
            if(analysis != null)
            shadowPrices = analysis.shadowPrice;
            constraintValues = data.finalValuesConstraints;
            if(operationsDone != null)
            $("#menIteration").text("Iteration: " + veces + " " + operationsDone);
            else
            $("#menIteration").text("Iteration: " + veces);
            pointRadius: 5;
            if (analysis == null) {
              $("#mensajeS").empty();
              console.log("entro:" + data.messageSol)

              $("#resultTable thead").empty();
              $("#resultTable tbody").empty();
              console.log(data)

              var p1 = new Promise((resolve, reject) => {
                $("#resultTable thead").append("<tr></tr>");
                $("#resultTable thead").find("tr").append("<th><font color='#fff'>Basics Variables</font></th>");
                $("#resultTable thead").find("tr").append("<th><font color='#fff'>Z</font></th>");
                for (index = 0; index < variableNames.length; index++) {
                  $("#resultTable thead").find("tr").append("<th><font color='#fff'>" + variableNames[index] + "</font></th>");

                }
                $("#resultTable thead").find("tr").append("<th><font color='#fff'>RHS</font></th>");
                $("#resultTable thead").find("tr").append("<th><font color='#fff'>Theta</font></th>");

                resolve();
              });

              for (let index = 0; index < actualMatrix.length; index++) {

                if (index == 0) {
                  $("#resultTable tbody").append("<tr></tr>");
                  $("#resultTable tbody").find("tr").append("<td>Z</td>");
                  $("#resultTable tbody").find("tr").append("<td>1</td>");
                  for (let j = 0; j < actualMatrix[0].length; j++) {
                    $("#resultTable tbody").find("tr").append("<td>" + actualMatrix[0][j] + "</td>");
                  }
                  $("#resultTable tbody").find("tr").append("<td></td>");
                } else if (index > 0) {

                  console.log("index:" + index + " valor:" + varsBase[index - 1])
                  $("#resultTable tbody").append("<tr id='row" + index + "'></tr>");
                  $("#resultTable tbody").find("#row" + index).append("<td>" + varsBase[index - 1] + "</td>");
                  $("#resultTable tbody").find("#row" + index).append("<td>0</td>");
                  for (let j = 0; j < actualMatrix[0].length; j++) {
                    $("#resultTable tbody").find("#row" + index).append("<td>" + actualMatrix[index][j] + "</td>");
                  }
                  if (theta != null) {
                    $("#resultTable tbody").find("#row" + index).append("<td>" + toInfinity(theta[index - 1]) + "</td>");
                  }

                }

              }

            }
              $("#mensajeS").empty();
              $("#tableShadowPrices").hide();
              $("#tableReducedCosts").hide();
          }, function (error) {
            $(".cover").toggle(900);
            alert("Failed to process requests.")

            console.log(error);
          });
        }
        function nextSolution() {
          veces++;
          console.log(veces)
          var rest = varCount + 1
          var string = constructRequestString2(veces);


          $.ajax({
            url: "https://icesiviptest.herokuapp.com/simplexMethod" + string
            //url: "http://localhost:8080/simplexMethod" + string
          }).then(function (data) {
            $("#resultTable-cont").show();
            variableNames = data.everyVariableName;
            var actualMatrix = data.actualMatrix;
            messageSol = data.messageSol;
            var operationsDone = data.operationsDone;
            var theta = data.theta;
            var varsBase = data.varsBase;
            solutionValues = data.varsValuesSolution;
            rhsInitM = data.rhsinitialM;
            nVarDeci = data.nVarDecision;
            analysis = data.analysis;
            fobjective = data.fobj;
            reducedC = data.reducedCosts;
            if(analysis != null){
            shadowPrices = analysis.shadowPrice;
            veces--;
            }
            constraintValues = data.finalValuesConstraints;
            if(operationsDone != null)
            $("#menIteration").text("Iteration: " + veces + " " + operationsDone);
            else
            $("#menIteration").text("Iteration: " + veces);
            pointRadius: 5;
            if (analysis == null) {
              $("#mensajeS").empty();
              console.log("entro:" + data.messageSol)

              $("#resultTable thead").empty();
              $("#resultTable tbody").empty();
              console.log(data)

              var p1 = new Promise((resolve, reject) => {
                $("#resultTable thead").append("<tr></tr>");
                $("#resultTable thead").find("tr").append("<th><font color='#fff'>Basics Variables</font></th>");
                $("#resultTable thead").find("tr").append("<th><font color='#fff'>Z</font></th>");
                for (index = 0; index < variableNames.length; index++) {
                  $("#resultTable thead").find("tr").append("<th><font color='#fff'>" + variableNames[index] + "</font></th>");

                }
                $("#resultTable thead").find("tr").append("<th><font color='#fff'>RHS</font></th>");
                $("#resultTable thead").find("tr").append("<th><font color='#fff'>Theta</font></th>");

                resolve();
              });

              for (let index = 0; index < actualMatrix.length; index++) {

                if (index == 0) {
                  $("#resultTable tbody").append("<tr></tr>");
                  $("#resultTable tbody").find("tr").append("<td>Z</td>");
                  $("#resultTable tbody").find("tr").append("<td>1</td>");
                  for (let j = 0; j < actualMatrix[0].length; j++) {
                    $("#resultTable tbody").find("tr").append("<td>" + actualMatrix[0][j] + "</td>");
                  }
                  $("#resultTable tbody").find("tr").append("<td></td>");
                } else if (index > 0) {

                  console.log("index:" + index + " valor:" + varsBase[index - 1])
                  $("#resultTable tbody").append("<tr id='row" + index + "'></tr>");
                  $("#resultTable tbody").find("#row" + index).append("<td>" + varsBase[index - 1] + "</td>");
                  $("#resultTable tbody").find("#row" + index).append("<td>0</td>");
                  for (let j = 0; j < actualMatrix[0].length; j++) {
                    $("#resultTable tbody").find("#row" + index).append("<td>" + actualMatrix[index][j] + "</td>");
                  }
                  if (theta != null) {
                    $("#resultTable tbody").find("#row" + index).append("<td>" + toInfinity(theta[index - 1]) + "</td>");
                  }

                }

              }

            }
            if (analysis != null) {
              termino = true;
             showSolution();
             
            }


          }, function (error) {
            $(".cover").toggle(900);
            alert("Failed to process requests.")

            console.log(error);
          });
        }

        function showSolution() {
          $("#mensajeS").empty();
          $("#mensajeS").append("<h3><font color= #1cc88a >" + messageSol + "</font></h3>");
          if(messageSol=="Problem finished" || messageSol=="Infinite solutions!"){
          var tableContent = "";
          for (let index = 0; index < variableNames.length; index++) {
          tableContent +='<tr><th><font>'+variableNames[index]+'</font></th><td>'+solutionValues[index]+'</td></tr>';
          }
          tableContent += '<tr><th><font>Z</font></th><td>'+solutionValues[variableNames.length]+'</td></tr>';
          $("#mensajeS").append("<h3 class = 'text-center'>Results per variable</h3>"
          +'<table class="table table-bordered" width="100%" cellspacing="0">'
          +'<thead class="white-text bg-primary">'
          +'<tr> <th> <font color="#fff">Var</font></th>'
          +'<th> <font color="#fff">Value</font></th>'
          +'</tr> </thead> <tbody>' + tableContent
          +'</tbody></table>');
        $("#mensajeS").append('<div class="row"><div class="col-sm-5"></div><div class="col"><button onclick="analysisS()" id = "Analysis" class="btn btn-outline-success btn-icon-split" type="button"><span class="text">Sensitivity Analysis</span> </button></div><div class="col"></div></div>');
          }
        }
        function exportToJson(objectData) {
          let filename = "Problem_" + document.getElementById("cTitle").value + ".json";
          let contentType = "application/json;charset=utf-8;";
          if (window.navigator && window.navigator.msSaveOrOpenBlob) {
            var blob = new Blob([decodeURIComponent(encodeURI(JSON.stringify(objectData)))], { type: contentType });
            navigator.msSaveOrOpenBlob(blob, filename);
          } else {
            var a = document.createElement('a');
            a.download = filename;
            a.href = 'data:' + contentType + ',' + encodeURIComponent(JSON.stringify(objectData));
            a.target = '_blank';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
          }
        }


        function saveProblem() {
          object = { data: document.getElementById("cTitle").value + "|" + constructRequestString() };
          exportToJson(object);
        }

      </script>

      <!-- Bootstrap core JavaScript-->

      <script src="vendor/jquery/jquery.min.js"></script>
      <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

      <!-- Core plugin JavaScript-->
      <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

      <!-- Custom scripts for all pages-->
      <script src="js/sb-admin-2.min.js"></script>

      <!-- Page level plugins -->
      <script src="vendor/datatables/jquery.dataTables.min.js"></script>
      <script src="vendor/datatables/dataTables.bootstrap4.min.js"></script>

      <!-- Page level custom scripts -->
      <script src="js/demo/datatables-demo.js"></script>

</body>

</html>